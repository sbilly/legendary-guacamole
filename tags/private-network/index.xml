<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Private Network on Keep Simple, Make Fun.</title>
    <link>https://sbilly.github.io/tags/private-network/</link>
    <description>Recent content in Private Network on Keep Simple, Make Fun.</description>
    <generator>Source Themes Academic (https://sourcethemes.com/academic/)</generator>
    <language>zh</language>
    <copyright>{year} &amp;copy;</copyright>
    <lastBuildDate>Fri, 26 Jul 2019 15:04:45 +0800</lastBuildDate>
    
	    <atom:link href="https://sbilly.github.io/tags/private-network/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>构建包含 WEB 管理界面的 go-ipfs 的私有网络</title>
      <link>https://sbilly.github.io/post/build-go-ipfs-private-network-with-webui-support/</link>
      <pubDate>Fri, 26 Jul 2019 15:04:45 +0800</pubDate>
      
      <guid>https://sbilly.github.io/post/build-go-ipfs-private-network-with-webui-support/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;media/15641153824612/15641250270855.jpg&#34; alt=&#34;!-w800&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://ipfs.io/&#34; target=&#34;_blank&#34;&gt;go-ipfs&lt;/a&gt; 是一个分布式基于区块链技术的分布式文件系统，文档可以查看 &lt;a href=&#34;https://docs.ipfs.io/&#34; target=&#34;_blank&#34;&gt;官方文档&lt;/a&gt; 。本文主要记录和介绍如何使用 go-ipfs 搭建与公有网络隔离的私有网络。&lt;/p&gt;

&lt;p&gt;下面将介绍如何从源码编译并启动 bootstrap 节点。go-ipfs 还在积极开发中，在 2019 年  7 月 26 日是可以正常完成的。如果发现有问题，可以在评论中反馈。&lt;/p&gt;

&lt;h2 id=&#34;准备-ipfs-环境&#34;&gt;准备 ipfs 环境&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# 创建 ipfs 的运行时目录
mkdir -p ./ipfs

# 获取 go-ipfs-swarm-key-gen
git clone https://github.com/Kubuxu/go-ipfs-swarm-key-gen

# 创建 swarm.key
# 所有的私有网络节点都需要这个 swarm.key 才能正常加入私有网络
cd go-ipfs-swarm-key-gen
IPFS_PATH=./ipfs go run ipfs-swarm-key-gen/main.go &amp;gt; $IPFS_PATH/swarm.key
cd ../

# 获取最新的 go-ipfs 源码
git clone https://github.com/ipfs/go-ipfs.git

# 编译 go-ipfs
cd go-ipfs
make build
cd ../

# 初始化 ipfs 的运行时目录
# 初始化时会创建 ipfs 的 peer identity，这个 peer identity 会在后续配置过程中使用到。peer identity 类似于下面这种形式：
# peer identity: QmQ2YEpJhikmMZJXG39fzxgQNCAFDzyv9m15xe9GsvkRPL
# IPFS_PATH=./ipfs 指定 ./ipfs 为运行时目录
# LIBP2P_FORCE_PNET=1 要求 ipfs 运行在私有网络模式
IPFS_PATH=./ipfs LIBP2P_FORCE_PNET=1 ./go-ipfs/cmd/ipfs/ipfs init

# 删除公开网络的所有 bootstrap 节点
IPFS_PATH=./ipfs LIBP2P_FORCE_PNET=1 ./go-ipfs/cmd/ipfs/ipfs bootstrap rm --all

# 把本机作为 bootstrap 节点
# 其中 QmQ2YEpJhikmMZJXG39fzxgQNCAFDzyv9m15xe9GsvkRPL 要修改为实际的 peer identity
IPFS_PATH=./ipfs LIBP2P_FORCE_PNET=1 ./go-ipfs/cmd/ipfs/ipfs bootstrap add /ip4/127.0.0.1/tcp/4001/ipfs/QmQ2YEpJhikmMZJXG39fzxgQNCAFDzyv9m15xe9GsvkRPL

# 启动 ipfs
IPFS_PATH=./ipfs LIBP2P_FORCE_PNET=1 ./go-ipfs/cmd/ipfs/ipfs daemon
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;编译并启用-ipfs-webui&#34;&gt;编译并启用 ipfs-webui&lt;/h2&gt;

&lt;p&gt;如果你希望像公网那样使用 ipfs 官方自带的管理界面 &lt;a href=&#34;https://github.com/ipfs-shipyard/ipfs-webui&#34; target=&#34;_blank&#34;&gt;ipfs-weibui&lt;/a&gt; 需要通过以下步骤使用最新的 ipfs-webui 。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# 获取最新的 ipfs-webui 代码
git clone https://github.com/ipfs-shipyard/ipfs-webui.git

# 编译 ipfs-webui
# 需要 python2 支持，需要使用 npm 而不要使用 cnpm
# 编译后的文件在 build
cd ipfs-webui
npm install
npm run build

# 把编译得到的 ipfs-webui 添加到 ipfs 文件系统私有网络中
# 下面的命令执行后会返回类似的响应，返回的 build 目录对应的 hash 在需要添加到 go-ipfs 代码中
# added QmRSgDcuaXEKJMTpJPL4bVDRRzWXmvF4Gt6cVBXsucpDMh build
IPFS_PATH=../ipfs LIBP2P_FORCE_PNET=1 ../go-ipfs/cmd/ipfs/ipfs add -r ./build
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;修改并重新编译-go-ipfs&#34;&gt;修改并重新编译 go-ipfs&lt;/h2&gt;

&lt;p&gt;修改文件把刚才编译的 ipfs-webui 加到 ipfs 中，需要修改 &lt;code&gt;go-ipfs/core/corehttp/webui.go&lt;/code&gt; 把 webui 对应的 hash 值替换成刚才添加到 ipfs 时的返回的 hash ，例如：&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;package corehttp

// TODO: move to IPNS
// 把 const WebUIPath 替换成私有网络中 webUI 的 PATH
const WebUIPath = &amp;quot;/ipfs/QmRSgDcuaXEKJMTpJPL4bVDRRzWXmvF4Gt6cVBXsucpDMh&amp;quot;

// this is a list of all past webUI paths.
// 原来公开网络的 webUI 路径保存在这个列表中
var WebUIPaths = []string{
        WebUIPath,
        &amp;quot;/ipfs/QmQNHd1suZTktPRhP7DD4nKWG46ZRSxkwHocycHVrK3dYW&amp;quot;, 
        &amp;quot;/ipfs/QmfQkD8pBSBCBxWEwFSu4XaDVSWK6bjnNuaWZjMyQbyDub&amp;quot;,
        &amp;quot;/ipfs/QmXc9raDM1M5G5fpBnVyQ71vR4gbnskwnB9iMEzBuLgvoZ&amp;quot;,
        &amp;quot;/ipfs/QmenEBWcAk3tN94fSKpKFtUMwty1qNwSYw3DMDFV6cPBXA&amp;quot;,
        &amp;quot;/ipfs/QmUnXcWZC5Ve21gUseouJsH5mLAyz5JPp8aHsg8qVUUK8e&amp;quot;,
        &amp;quot;/ipfs/QmSDgpiHco5yXdyVTfhKxr3aiJ82ynz8V14QcGKicM3rVh&amp;quot;,
        &amp;quot;/ipfs/QmRuvWJz1Fc8B9cTsAYANHTXqGmKR9DVfY5nvMD1uA2WQ8&amp;quot;,
        &amp;quot;/ipfs/QmQLXHs7K98JNQdWrBB2cQLJahPhmupbDjRuH1b9ibmwVa&amp;quot;,
        &amp;quot;/ipfs/QmXX7YRpU7nNBKfw75VG7Y1c3GwpSAGHRev67XVPgZFv9R&amp;quot;,
        &amp;quot;/ipfs/QmXdu7HWdV6CUaUabd9q2ZeA4iHZLVyDRj3Gi4dsJsWjbr&amp;quot;,
        &amp;quot;/ipfs/QmaaqrHyAQm7gALkRW8DcfGX3u8q9rWKnxEMmf7m9z515w&amp;quot;,
        &amp;quot;/ipfs/QmSHDxWsMPuJQKWmVA1rB5a3NX2Eme5fPqNb63qwaqiqSp&amp;quot;,
        &amp;quot;/ipfs/QmctngrQAt9fjpQUZr7Bx3BsXUcif52eZGTizWhvcShsjz&amp;quot;,
        &amp;quot;/ipfs/QmS2HL9v5YeKgQkkWMvs1EMnFtUowTEdFfSSeMT4pos1e6&amp;quot;,
        &amp;quot;/ipfs/QmR9MzChjp1MdFWik7NjEjqKQMzVmBkdK3dz14A6B5Cupm&amp;quot;,
        &amp;quot;/ipfs/QmRyWyKWmphamkMRnJVjUTzSFSAAZowYP4rnbgnfMXC9Mr&amp;quot;,
        &amp;quot;/ipfs/QmU3o9bvfenhTKhxUakbYrLDnZU7HezAVxPM6Ehjw9Xjqy&amp;quot;,
        &amp;quot;/ipfs/QmPhnvn747LqwPYMJmQVorMaGbMSgA7mRRoyyZYz3DoZRQ&amp;quot;,
}

var WebUIOption = RedirectOption(&amp;quot;webui&amp;quot;, WebUIPath)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;重新编译 go-ipfs，启动后缺省可以通过 &lt;code&gt;http://127.0.0.1:5001/webui&lt;/code&gt; 访问到 ipfs 的管理界面。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# 编译 go-ipfs
cd go-ipfs
make build
cd ../

# 启动 ipfs
IPFS_PATH=./ipfs LIBP2P_FORCE_PNET=1 ./go-ipfs/cmd/ipfs/ipfs deamon
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;启动其他节点&#34;&gt;启动其他节点&lt;/h2&gt;

&lt;p&gt;把 &lt;a href=&#34;#toc_1&#34;&gt;准备 ipfs 环境&lt;/a&gt; 中创建的 &lt;code&gt;swarm.key&lt;/code&gt; 复制到合理位置，并且按照 &lt;a href=&#34;#toc_1&#34;&gt;准备 ipfs 环境&lt;/a&gt; 编译 go-ipfs、修改 bootstrap 节点、启动 ipfs 即可。如果一切正常，就可以在 bootstrap 节点上可以看到连接上来的 peer 节点。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;media/15641153824612/15641244880502.jpg&#34; alt=&#34;-w600&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;参考&#34;&gt;参考&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/ahester57/ipfs-private-swarm&#34; target=&#34;_blank&#34;&gt;IPFS Private Swarm&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
  </channel>
</rss>
